FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWVsYXN0aWNzZWFyY2gtYXBiCmRlc2NyaXB0aW9uOiBU\
aGlzIGlzIGEgc2FtcGxlIGFwcGxpY2F0aW9uIGdlbmVyYXRlZCBieSBhcGIgaW5pdApiaW5kYWJs\
ZTogRmFsc2UKYXN5bmM6IG9wdGlvbmFsCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBudXhlby1l\
bGFzdGljc2VhcmNoCnBsYW5zOgogIC0gbmFtZTogc2VjdXJlZAogICAgZGVzY3JpcHRpb246IFRo\
aXMgZGVmYXVsdCBwbGFuIGRlcGxveXMgbnV4ZW8tZWxhc3RpY3NlYXJjaC1hcGIKICAgIGZyZWU6\
IFRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTogRWxh\
c3RpY3NlYXJjaCB1c2VyIG5hbWUKICAgICAgICBuYW1lOiBlbGFzdGljX3VzZXJfbmFtZQogICAg\
ICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogImVsYXN0aWMiCiAgICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgIC0gdGl0bGU6IEVsYXN0aWNzZWFyY2ggdXNlciBwYXNzd29yZAogICAg\
ICAgIG5hbWU6IGVsYXN0aWNfdXNlcl9wYXNzd29yZCAKICAgICAgICB0eXBlOiBzdHJpbmcKICAg\
ICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfLi1dKiQiICAgICAgICAKICAgICAgICBkaXNwbGF5\
X3R5cGU6IHBhc3N3b3JkICAgICAgICAKICAgICAgCiAgICAgIC0gbmFtZTogaW1hZ2VfcmVwb3Np\
dG9yeQogICAgICAgIGRlZmF1bHQ6ICdudXhlby9lbGFzdGljc2VhcmNoLXNnOjUuNi45JwogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBFbGFzdGljc2VhcmNoIGltYWdlIG5hbWUK\
ICAgICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MKICAgICAgLSBuYW1lOiBpbWFn\
ZV90YWcKICAgICAgICBkZWZhdWx0OiAnNS42LjUnCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAg\
ICAgdGl0bGU6IEVsYXN0aWNzZWFyY2ggSW1hZ2UgdGFnCiAgICAgICAgZGlzcGxheV9ncm91cDog\
Q29udGFpbmVyIFNwZWNzCiAgICAgIC0gbmFtZTogaW1hZ2VfcHVsbFBvbGljeQogICAgICAgIGRl\
ZmF1bHQ6ICdJZk5vdFByZXNlbnQnCiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVudW06IFsn\
SWZOb3RQcmVzZW50JywgJ0Fsd2F5cycsICdOZXZlciddCiAgICAgICAgdGl0bGU6IEVsYXN0aWNz\
ZWFyY2ggaW1hZ2UgcHVsbCBwb2xpY3kKICAgICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIg\
U3BlY3MKICAgICAgLSB0aXRsZTogVGhlIGNsaWVudCBkZXBsb3ltZW50IG5hbWUKICAgICAgICBu\
YW1lOiBjbGllbnRfbmFtZQogICAgICAgIGRlZmF1bHQ6IGNsaWVudAogICAgICAgIHR5cGU6IHN0\
cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFRoZSBjbGllbnQgcmVw\
bGljYSBjb3VudAogICAgICAgIG5hbWU6IGNsaWVudF9yZXBsaWNhX2NvdW50CiAgICAgICAgZGVm\
YXVsdDogIjIiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAg\
ICAgLSB0aXRsZTogVGhlIGNsaWVudCBzZXJ2aWNlIHR5cGUKICAgICAgICBuYW1lOiBjbGllbnRf\
c2VydmljZV90eXBlCiAgICAgICAgZGVmYXVsdDogQ2x1c3RlcklQCiAgICAgICAgdHlwZTogc3Ry\
aW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogVGhlIGNsaWVudCBKQVZB\
X09QVFMgKEhlYXAgZGVmYXVsdHMgdG8gaGFsZiBvZiB0aGUgQ0dyb3VwIGF2YWlsYWJsZSBtZW1v\
cnkpCiAgICAgICAgbmFtZTogY2xpZW50X2phdmFfb3B0cwogICAgICAgIGRlZmF1bHQ6IC1YWDor\
VW5sb2NrRXhwZXJpbWVudGFsVk1PcHRpb25zIC1YWDorVXNlQ0dyb3VwTWVtb3J5TGltaXRGb3JI\
ZWFwIC1YWDpNYXhSQU1GcmFjdGlvbj0yCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVx\
dWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogQ2xpZW50IFBvZHMgcmVzb3VyY2UgcmVxdWVzdHMg\
YW5kIGxpbWl0cwogICAgICAgIG5hbWU6IGNsaWVudF9yZXNvdXJjZXMKICAgICAgICByZXF1aXJl\
ZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6ICd7bGltaXRzOiB7Y3B1OiA1MDBtLCBtZW1vcnk6IDUx\
Mk1pfSwgcmVxdWVzdHM6IHtjcHU6IDEwMG0sIG1lbW9yeTogMjU2TWl9fScgICAgICAgICAgICAg\
ICAgCiAgICAgICAgZGlzcGxheV90eXBlOiB0ZXh0YXJlYQogICAgICAgIGRpc3BsYXlfZ3JvdXA6\
IENvbnRhaW5lciBTcGVjcwogICAgICAgIHR5cGU6IHN0cmluZyAgICAgICAgCgogICAgICAtIHRp\
dGxlOiBUaGUgbWFzdGVyIG5hbWUKICAgICAgICBuYW1lOiBtYXN0ZXJfbmFtZQogICAgICAgIGRl\
ZmF1bHQ6IG1hc3RlcgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVl\
CiAgICAgIC0gdGl0bGU6IFRoZSBtYXN0ZXIgcmVwbGljYSBjb3VudAogICAgICAgIG5hbWU6IG1h\
c3Rlcl9yZXBsaWNhX2NvdW50CiAgICAgICAgZGVmYXVsdDogIjMiCiAgICAgICAgdHlwZTogc3Ry\
aW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogVGhlIG1hc3RlciBKQVZB\
X09QVFMgKEhlYXAgZGVmYXVsdHMgdG8gaGFsZiBvZiB0aGUgQ0dyb3VwIGF2YWlsYWJsZSBtZW1v\
cnkpCiAgICAgICAgbmFtZTogbWFzdGVyX2phdmFfb3B0cwogICAgICAgIGRlZmF1bHQ6IC1YWDor\
VW5sb2NrRXhwZXJpbWVudGFsVk1PcHRpb25zIC1YWDorVXNlQ0dyb3VwTWVtb3J5TGltaXRGb3JI\
ZWFwIC1YWDpNYXhSQU1GcmFjdGlvbj0yCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVx\
dWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogTWFzdGVyIFBvZHMgcmVzb3VyY2UgcmVxdWVzdHMg\
YW5kIGxpbWl0cwogICAgICAgIG5hbWU6IG1hc3Rlcl9yZXNvdXJjZXMKICAgICAgICByZXF1aXJl\
ZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6ICd7bGltaXRzOiB7Y3B1OiA1MDBtLCBtZW1vcnk6IDUx\
Mk1pfSwgcmVxdWVzdHM6IHtjcHU6IDEwMG0sIG1lbW9yeTogMjU2TWl9fScgICAgICAgIAogICAg\
ICAgIGRpc3BsYXlfdHlwZTogdGV4dGFyZWEKICAgICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWlu\
ZXIgU3BlY3MKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgLSB0aXRsZTogU2l6ZSBvZiBwZXJz\
aXN0ZW50IHN0b3JhZ2UgZm9yIHRoZSBtYXN0ZXIgbm9kZQogICAgICAgIG5hbWU6IG1hc3Rlcl9w\
ZXJzaXN0ZW5jZV9zaXplCiAgICAgICAgZGVmYXVsdDogNEdpCiAgICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogUGVyc2lzdGVudCBzdG9yYWdl\
IGNsYXNzIG5hbWUgZm9yIHRoZSBtYXN0ZXIgbm9kZQogICAgICAgIG5hbWU6IG1hc3Rlcl9wZXJz\
aXN0ZW5jZV9zdG9yYWdlX2NsYXNzX25hbWUgICAgICAgIAogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHJlcXVpcmVkOiBmYWxzZQoKICAgICAgLSB0aXRsZTogVGhlIGRhdGEgbm9kZSBuYW1l\
CiAgICAgICAgbmFtZTogZGF0YV9uYW1lCiAgICAgICAgZGVmYXVsdDogZGF0YQogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFRoZSBkYXRh\
IG5vZGUgcmVwbGljYSBjb3VudAogICAgICAgIG5hbWU6IGRhdGFfcmVwbGljYV9jb3VudAogICAg\
ICAgIGRlZmF1bHQ6ICIzIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0\
cnVlCgogICAgICAtIHRpdGxlOiBUaGUgZGF0YSBKQVZBX09QVFMgKEhlYXAgZGVmYXVsdHMgdG8g\
aGFsZiBvZiB0aGUgQ0dyb3VwIGF2YWlsYWJsZSBtZW1vcnkpCiAgICAgICAgbmFtZTogZGF0YV9q\
YXZhX29wdHMKICAgICAgICBkZWZhdWx0OiAtWFg6K1VubG9ja0V4cGVyaW1lbnRhbFZNT3B0aW9u\
cyAtWFg6K1VzZUNHcm91cE1lbW9yeUxpbWl0Rm9ySGVhcCAtWFg6TWF4UkFNRnJhY3Rpb249Mgog\
ICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6\
IERhdGEgUG9kcyByZXNvdXJjZSByZXF1ZXN0cyBhbmQgbGltaXRzCiAgICAgICAgbmFtZTogZGF0\
YV9yZXNvdXJjZXMKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6ICd7bGlt\
aXRzOiB7Y3B1OiA1MDBtLCBtZW1vcnk6IDUxMk1pfSwgcmVxdWVzdHM6IHtjcHU6IDEwMG0sIG1l\
bW9yeTogMjU2TWl9fScKICAgICAgICBkaXNwbGF5X3R5cGU6IHRleHRhcmVhCiAgICAgICAgZGlz\
cGxheV9ncm91cDogQ29udGFpbmVyIFNwZWNzCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgIC0g\
dGl0bGU6IFNpemUgb2YgcGVyc2lzdGVudCBzdG9yYWdlIGZvciB0aGUgZGF0YSBub2RlCiAgICAg\
ICAgbmFtZTogZGF0YV9wZXJzaXN0ZW5jZV9zaXplCiAgICAgICAgZGVmYXVsdDogMTBHaQogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFBl\
cnNpc3RlbnQgc3RvcmFnZSBjbGFzcyBuYW1lIGZvciB0aGUgZGF0YSBub2RlCiAgICAgICAgbmFt\
ZTogZGF0YV9wZXJzaXN0ZW5jZV9zdG9yYWdlX2NsYXNzX25hbWUKICAgICAgICBkZWZhdWx0OiAi\
IgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAtIHRp\
dGxlOiBUZXJtaW5hdGlvbiBHcmFjZSBQZXJpb2QgaW4gc2Vjb25kcyBmb3IgdGhlIGRhdGEgbm9k\
ZQogICAgICAgIG5hbWU6IGRhdGFfdGVybWluYXRpb25fZ3JhY2VfcGVyaW9kCiAgICAgICAgZGVm\
YXVsdDogIjM2MDAiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUg\
ICAgICAgIAogICAgICAtIG5hbWU6IHRsc19jYXN1YmplY3REaXN0aW5ndWlzaGVkTmFtZQogICAg\
ICAgIGRlZmF1bHQ6ICcvQ049bnV4ZW8tYmFja2luZ3MuZWxhc3RpY3NlYXJjaC5zdmMvT1U9ZW5n\
aW5lZXJpbmcvTz1udXhlby9MPWlydmluZS9TVD1jYS9DPXVzJwogICAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICAgIHRpdGxlOiBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgU3ViamVjdCBEaXN0aW5ndWlz\
aGVkIE5hbWUgZm9yIHRoZSBNb25nb0RCIGNsdXN0ZXIgaW4gc2luZ2xlIHN0cmluZyBmb3JtYXQK\
ICAgICAgICBkaXNwbGF5X2dyb3VwOiBNb25nb0RCIFNlY3VyaXR5IENvbmZpZwogICAgICAtIG5h\
bWU6IGNlcnRpZmljYXRlX3ZhbGlkaXR5CiAgICAgICAgdGl0bGU6IENlcnRpZmljYXRlIHZhbGlk\
aXR5IHBlcmlvZCBpbiBkYXlzCiAgICAgICAgZGVmYXVsdDogMzY1MAogICAgICAgIHR5cGU6IHN0\
cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCgo="

# Needed for keytool
RUN yum install -y java-1.8.0-openjdk httpd-tools

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-elasticsearch-apb

RUN chmod -R g=u /opt/{ansible,apb}

### INSTALL THE REQUIRED PACKAGES

USER apb
