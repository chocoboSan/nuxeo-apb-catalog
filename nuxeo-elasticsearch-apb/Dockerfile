FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWVsYXN0aWNzZWFyY2gtYXBiCmRlc2NyaXB0aW9uOiBU\
aGlzIGlzIGEgc2FtcGxlIGFwcGxpY2F0aW9uIGdlbmVyYXRlZCBieSBhcGIgaW5pdApiaW5kYWJs\
ZTogRmFsc2UKYXN5bmM6IG9wdGlvbmFsCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBudXhlby1l\
bGFzdGljc2VhcmNoCnBsYW5zOgogIC0gbmFtZTogc2VjdXJlZAogICAgZGVzY3JpcHRpb246IFRo\
aXMgZGVmYXVsdCBwbGFuIGRlcGxveXMgbnV4ZW8tZWxhc3RpY3NlYXJjaC1hcGIKICAgIGZyZWU6\
IFRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTogVGhl\
IG5hbWUgb2YgdGhlIGJhY2tpbmdzIHN0YWNrLgogICAgICAgIG5hbWU6IE5VWEVPX0JBQ0tJTkdT\
X05BTUUKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6ICJudXhlby1iYWNr\
aW5ncyIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgLSB0aXRsZTogSGFzaGVkIHBhc3N3b3Jk\
IGZvciBlbGFzdGljIHVzZXIgKGJjcnlwdCkKICAgICAgICBuYW1lOiBTRUFSQ0hHVUFSRF9IQVNI\
RURfUEFTU1dPUkQKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6ICJwYXNz\
d29yZCIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgLSB0aXRsZTogRWxhc3RpY3NlYXJjaCBj\
bHVzdGVyIG5hbWUKICAgICAgICBuYW1lOiBDTFVTVEVSX05BTUUKICAgICAgICBkZWZhdWx0OiBu\
dXhlbwogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0g\
dGl0bGU6IFRoZSBpbWFnZSByZXBvc2l0b3J5CiAgICAgICAgbmFtZTogSU1BR0VfUkVQT1NJVE9S\
WQogICAgICAgIGRlZmF1bHQ6IGRvY2tlci5lbGFzdGljLmNvL2VsYXN0aWNzZWFyY2gvZWxhc3Rp\
Y3NlYXJjaAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAg\
IC0gdGl0bGU6IFRoZSBpbWFnZSB0YWcKICAgICAgICBuYW1lOiBJTUFHRV9UQUcKICAgICAgICBk\
ZWZhdWx0OiA1LjYuNQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVl\
CiAgICAgIC0gdGl0bGU6IFRoZSBpbWFnZSBwdWxsIHBvbGljeQogICAgICAgIG5hbWU6IElNQUdF\
X1BVTExfUE9MSUNZCiAgICAgICAgZGVmYXVsdDogSWZOb3RQcmVzZW50CiAgICAgICAgdHlwZTog\
c3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogVGhlIGNsaWVudCBu\
YW1lCiAgICAgICAgbmFtZTogQ0xJRU5UX05BTUUKICAgICAgICBkZWZhdWx0OiBjbGllbnQKICAg\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBU\
aGUgY2xpZW50IHJlcGxpY2EgY291bnQKICAgICAgICBuYW1lOiBDTElFTlRfUkVQTElDQV9DT1VO\
VAogICAgICAgIGRlZmF1bHQ6ICIyIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVp\
cmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFRoZSBjbGllbnQgc2VydmljZSB0eXBlCiAgICAgICAg\
bmFtZTogQ0xJRU5UX1NFUlZJQ0VfVFlQRQogICAgICAgIGRlZmF1bHQ6IENsdXN0ZXJJUAogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFRo\
ZSBjbGllbnQgaGVhcCBzaXplCiAgICAgICAgbmFtZTogQ0xJRU5UX0hFQVBfU0laRQogICAgICAg\
IGRlZmF1bHQ6IDI1Nm0KICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1\
ZQogICAgICAtIHRpdGxlOiBUaGUgYW1vdW50IG9mIENQVSB0byByZXF1ZXN0IGZvciB0aGUgY2xp\
ZW50CiAgICAgICAgbmFtZTogQ0xJRU5UX1JFUVVFU1RTX0NQVQogICAgICAgIHJlcXVpcmVkOiB0\
cnVlCiAgICAgICAgZGVmYXVsdDogMjVtCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgIC0gdGl0\
bGU6IFRoZSBhbW91bnQgb2YgbWVtb3J5IHRvIHJlcXVlc3QgZm9yIHRoZSBjbGllbnQKICAgICAg\
ICBuYW1lOiBDTElFTlRfUkVRVUVTVFNfTUVNT1JZCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAg\
ICAgICBkZWZhdWx0OiAyNTZNaQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAtIHRpdGxlOiBU\
aGUgQ1BVIGxpbWl0IGZvciB0aGUgY2xpZW50CiAgICAgICAgbmFtZTogQ0xJRU5UX0xJTUlUU19D\
UFUKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6ICIxIgogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAtIHRpdGxlOiBUaGUgbWFzdGVyIG5hbWUKICAgICAgICBuYW1lOiBN\
QVNURVJfTkFNRQogICAgICAgIGRlZmF1bHQ6IG1hc3RlcgogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFRoZSBtYXN0ZXIgcmVwbGljYSBj\
b3VudAogICAgICAgIG5hbWU6IE1BU1RFUl9SRVBMSUNBX0NPVU5UCiAgICAgICAgZGVmYXVsdDog\
IjMiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0\
aXRsZTogVGhlIG1hc3RlciBoZWFwIHNpemUKICAgICAgICBuYW1lOiBNQVNURVJfSEVBUF9TSVpF\
CiAgICAgICAgZGVmYXVsdDogMjU2bQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVp\
cmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFRoZSBhbW91bnQgb2YgQ1BVIHRvIHJlcXVlc3QgZm9y\
IHRoZSBtYXN0ZXIKICAgICAgICBuYW1lOiBNQVNURVJfUkVRVUVTVFNfQ1BVCiAgICAgICAgcmVx\
dWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAyNW0KICAgICAgICB0eXBlOiBzdHJpbmcKICAg\
ICAgLSB0aXRsZTogVGhlIGFtb3VudCBvZiBtZW1vcnkgdG8gcmVxdWVzdCBmb3IgdGhlIG1hc3Rl\
cgogICAgICAgIG5hbWU6IE1BU1RFUl9SRVFVRVNUU19NRU1PUlkKICAgICAgICByZXF1aXJlZDog\
dHJ1ZQogICAgICAgIGRlZmF1bHQ6IDI1Nk1pCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgIC0g\
dGl0bGU6IFRoZSBDUFUgbGltaXQgZm9yIHRoZSBtYXN0ZXIKICAgICAgICBuYW1lOiBNQVNURVJf\
TElNSVRTX0NQVQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogIjEiCiAg\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgIC0gdGl0bGU6IFNpemUgb2YgcGVyc2lzdGVudCBzdG9y\
YWdlIGZvciB0aGUgbWFzdGVyIG5vZGUKICAgICAgICBuYW1lOiBNQVNURVJfUEVSU0lTVEVOQ0Vf\
U0laRQogICAgICAgIGRlZmF1bHQ6IDRHaQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJl\
cXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFBlcnNpc3RlbnQgc3RvcmFnZSBjbGFzcyBuYW1l\
IGZvciB0aGUgbWFzdGVyIG5vZGUKICAgICAgICBuYW1lOiBNQVNURVJfUEVSU0lTVEVOQ0VfU1RP\
UkFHRV9DTEFTU19OQU1FCiAgICAgICAgZGVmYXVsdDogImF3cy1mYXN0IgogICAgICAgIHR5cGU6\
IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAtIHRpdGxlOiBUaGUgZGF0YSBu\
b2RlIG5hbWUKICAgICAgICBuYW1lOiBEQVRBX05BTUUKICAgICAgICBkZWZhdWx0OiBkYXRhCiAg\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTog\
VGhlIGRhdGEgbm9kZSByZXBsaWNhIGNvdW50CiAgICAgICAgbmFtZTogREFUQV9SRVBMSUNBX0NP\
VU5UCiAgICAgICAgZGVmYXVsdDogIjMiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVx\
dWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogVGhlIGRhdGEgbm9kZSBoZWFwIHNpemUKICAgICAg\
ICBuYW1lOiBEQVRBX0hFQVBfU0laRQogICAgICAgIGRlZmF1bHQ6IDEwMjRtCiAgICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogVGhlIGFtb3Vu\
dCBvZiBDUFUgdG8gcmVxdWVzdCBmb3IgdGhlIGRhdGEgbm9kZQogICAgICAgIG5hbWU6IERBVEFf\
UkVRVUVTVFNfQ1BVCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAyNW0K\
ICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgLSB0aXRsZTogVGhlIGFtb3VudCBvZiBtZW1vcnkg\
dG8gcmVxdWVzdCBmb3IgdGhlIGRhdGEgbm9kZQogICAgICAgIG5hbWU6IERBVEFfUkVRVUVTVFNf\
TUVNT1JZCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAxMDI0TWkKICAg\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgLSB0aXRsZTogVGhlIENQVSBsaW1pdCBmb3IgdGhlIGRh\
dGEgbm9kZQogICAgICAgIG5hbWU6IERBVEFfTElNSVRTX0NQVQogICAgICAgIHJlcXVpcmVkOiB0\
cnVlCiAgICAgICAgZGVmYXVsdDogIjEiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgIC0gdGl0\
bGU6IFNpemUgb2YgcGVyc2lzdGVudCBzdG9yYWdlIGZvciB0aGUgZGF0YSBub2RlCiAgICAgICAg\
bmFtZTogREFUQV9QRVJTSVNURU5DRV9TSVpFCiAgICAgICAgZGVmYXVsdDogMTBHaQogICAgICAg\
IHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFBlcnNp\
c3RlbnQgc3RvcmFnZSBjbGFzcyBuYW1lIGZvciB0aGUgZGF0YSBub2RlCiAgICAgICAgbmFtZTog\
REFUQV9QRVJTSVNURU5DRV9TVE9SQUdFX0NMQVNTX05BTUUKICAgICAgICBkZWZhdWx0OiAiYXdz\
LWZhc3QiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAg\
IC0gdGl0bGU6IFRlcm1pbmF0aW9uIEdyYWNlIFBlcmlvZCBpbiBzZWNvbmRzIGZvciB0aGUgZGF0\
YSBub2RlCiAgICAgICAgbmFtZTogREFUQV9URVJNSU5BVElPTl9HUkFDRV9QRVJJT0QKICAgICAg\
ICBkZWZhdWx0OiAiMzYwMCIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDog\
dHJ1ZQo="

# Needed for keytool
RUN yum install -y java-1.8.0-openjdk

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-mongodb-apb

RUN chmod -R g=u /opt/{ansible,apb}

### INSTALL THE REQUIRED PACKAGES

USER apb
