---
version: 1.0
name: nuxeo-elasticsearch-apb
description: Elasticsearch is a distributed, RESTful search and analytics engine
bindable: "True"
async: optional
tags:
  - database
  - elasticsearch
  - nuxeo
metadata:
  displayName: Nuxeo Elasticsearch (APB)
  longDescription:
    Elasticsearch is a distributed, RESTful search and analytics engine capable of solving
    a growing number of use cases. As the heart of the Elastic Stack, it centrally stores
    your data so you can discover the expected and uncover the unexpected.
    This APB covers a clustered deployment without security and and one plan with the
    open source SearchGuard plugin that features TLS encryption, Authentication and authorization mecanism.
  dependencies:
    - "docker.elastic.co/elasticsearch/elasticsearch:5.6.9"
    - "nuxeo/elasticsearch-sg:5.6.9"
    - "docker.io/busybox"
  providerDisplayName: "Nuxeo"
  documentationUrl: "https://github.com/nuxeo-sandbox/nuxeo-apb-catalog/nuxeo-elasticsearch-apb/README.md"
  imageUrl: "https://www.elastic.co/static/images/elastic-logo-200.png"

plans:
  - name: default
    description: This plan deploys a guenine Elasticsearch cluster
    free: True
    metadata: {}
    parameters:
      - title: Elasticsearch Cluster name
        name: cluster_name
        type: string
      - name: image_repository
        default: 'docker.elastic.co/elasticsearch/elasticsearch'
        type: string
        title: Elasticsearch image name
        display_group: Container Specs
      - name: image_tag
        default: '5.6.5'
        type: string
        title: Elasticsearch Image tag
        display_group: Container Specs
      - name: image_pullPolicy
        default: 'IfNotPresent'
        type: enum
        enum: ['IfNotPresent', 'Always', 'Never']
        title: Elasticsearch image pull policy
        display_group: Container Specs
      - title: The client replica count
        name: client_replica_count
        default: "2"
        type: string
        required: true
      - title: The client JAVA_OPTS (Heap defaults to half of the CGroup available memory)
        name: client_java_opts
        default: -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=2
        type: string
        required: true
      - title: Client Pods resource requests and limits
        name: client_resources
        required: true
        default: '{limits: {cpu: 500m, memory: 512Mi}, requests: {cpu: 100m, memory: 256Mi}}'
        display_type: textarea
        display_group: Container Specs
        type: string

      - title: The master replica count
        name: master_replica_count
        default: "3"
        type: string
        required: true
      - title: The master JAVA_OPTS (Heap defaults to half of the CGroup available memory)
        name: master_java_opts
        default: -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=2
        type: string
        required: true
      - title: Master Pods resource requests and limits
        name: master_resources
        required: true
        default: '{limits: {cpu: 500m, memory: 512Mi}, requests: {cpu: 100m, memory: 256Mi}}'
        display_type: textarea
        display_group: Container Specs
        type: string
      - title: Size of persistent storage for the master node
        name: master_persistence_size
        default: 4Gi
        type: string
        required: true
      - title: Persistent storage class name for the master node
        name: master_persistence_storage_class_name
        type: string
        required: false

      - title: The data node replica count
        name: data_replica_count
        default: "3"
        type: string
        required: true

      - title: The data JAVA_OPTS (Heap defaults to half of the CGroup available memory)
        name: data_java_opts
        default: -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=2
        type: string
        required: true
      - title: Data Pods resource requests and limits
        name: data_resources
        required: true
        default: '{limits: {cpu: 500m, memory: 512Mi}, requests: {cpu: 100m, memory: 256Mi}}'
        display_type: textarea
        display_group: Container Specs
        type: string
      - title: Size of persistent storage for the data node
        name: data_persistence_size
        default: 10Gi
        type: string
        required: true
      - title: Persistent storage class name for the data node
        name: data_persistence_storage_class_name
        default: ""
        type: string
        required: false
      - title: Termination Grace Period in seconds for the data node
        name: data_termination_grace_period
        default: "3600"
        type: string
        required: true

  - name: secured
    description: |
        This plan deploys an Elasticsearch cluster with SearchGuard installed
        and configured.
    free: True
    metadata: {}
    parameters:
      - title: Elasticsearch user name
        name: elastic_user_name
        required: true
        default: "elastic"
        type: string
      - title: Elasticsearch user password
        name: elastic_user_password
        type: string
        pattern: "^[a-zA-Z0-9_.-]*$"
        display_type: password
      - title: Elasticsearch Cluster name
        name: cluster_name
        type: string
      - name: image_repository
        default: 'nuxeo/elasticsearch-sg:5.6.9'
        type: string
        title: Elasticsearch image name
        display_group: Container Specs
      - name: image_tag
        default: '5.6.5'
        type: string
        title: Elasticsearch Image tag
        display_group: Container Specs
      - name: image_pullPolicy
        default: 'IfNotPresent'
        type: enum
        enum: ['IfNotPresent', 'Always', 'Never']
        title: Elasticsearch image pull policy
        display_group: Container Specs
      - title: The client replica count
        name: client_replica_count
        default: "2"
        type: string
        required: true
      - title: The client JAVA_OPTS (Heap defaults to half of the CGroup available memory)
        name: client_java_opts
        default: -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=2
        type: string
        required: true
      - title: Client Pods resource requests and limits
        name: client_resources
        required: true
        default: '{limits: {cpu: 500m, memory: 512Mi}, requests: {cpu: 100m, memory: 256Mi}}'
        display_type: textarea
        display_group: Container Specs
        type: string

      - title: The master replica count
        name: master_replica_count
        default: "3"
        type: string
        required: true
      - title: The master JAVA_OPTS (Heap defaults to half of the CGroup available memory)
        name: master_java_opts
        default: -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=2
        type: string
        required: true
      - title: Master Pods resource requests and limits
        name: master_resources
        required: true
        default: '{limits: {cpu: 500m, memory: 512Mi}, requests: {cpu: 100m, memory: 256Mi}}'
        display_type: textarea
        display_group: Container Specs
        type: string
      - title: Size of persistent storage for the master node
        name: master_persistence_size
        default: 4Gi
        type: string
        required: true
      - title: Persistent storage class name for the master node
        name: master_persistence_storage_class_name
        type: string
        required: false

      - title: The data node replica count
        name: data_replica_count
        default: "3"
        type: string
        required: true

      - title: The data JAVA_OPTS (Heap defaults to half of the CGroup available memory)
        name: data_java_opts
        default: -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=2
        type: string
        required: true
      - title: Data Pods resource requests and limits
        name: data_resources
        required: true
        default: '{limits: {cpu: 500m, memory: 512Mi}, requests: {cpu: 100m, memory: 256Mi}}'
        display_type: textarea
        display_group: Container Specs
        type: string
      - title: Size of persistent storage for the data node
        name: data_persistence_size
        default: 10Gi
        type: string
        required: true
      - title: Persistent storage class name for the data node
        name: data_persistence_storage_class_name
        default: ""
        type: string
        required: false
      - title: Termination Grace Period in seconds for the data node
        name: data_termination_grace_period
        default: "3600"
        type: string
        required: true
      - name: tls_casubjectDistinguishedNameSuffix
        default: '/OU=engineering/O=nuxeo/L=irvine/ST=ca/C=us'
        type: string
        title: Certificate Authority Subject Distinguished Name for the MongoDB cluster in single string format
        display_group: MongoDB Security Config
      - name: certificate_validity
        title: Certificate validity period in days
        default: 3650
        type: string
        required: true