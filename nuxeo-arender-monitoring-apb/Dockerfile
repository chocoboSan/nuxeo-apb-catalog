FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWFyZW5kZXItbW9uaXRvcmluZy1hcGIKZGVzY3JpcHRp\
b246IEFSZW5kZXIgTW9uaXRvcmluZyBkZXBsb3ltZW50IGluIE9wZW5zaGlmdCBmb3IgTnV4ZW8K\
YmluZGFibGU6IFRydWUKYXN5bmM6IG9wdGlvbmFsCnRhZ3M6CiAgLSBudXhlbwogIC0gYXJlbmRl\
cgptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogQVJlbmRlciBNb25pdG9yaW5nIGVudmlyb25tZW50\
IGZvciBOdXhlbwogIGltYWdlVXJsOiAiaHR0cHM6Ly93d3cubnV4ZW8uY29tL2Fzc2V0cy9pbWdz\
L2xvZ28zNDB4NjAucG5nIgogIGxvbmdEZXNjcmlwdGlvbjoKICAgIFRoaXMgRGVwbG95cyBhbiBB\
UmVuZGVyIG1vbml0b3Jpbmcgc3RhY2sKICBkZXBlbmRlbmNpZXM6IFtdCiAgcHJvdmlkZXJEaXNw\
bGF5TmFtZTogIk51eGVvIgpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9u\
OiBEZWZhdWx0IEFSZW5kZXIgTWV0cmljcyBkZXBsb3ltZW50CiAgICBmcmVlOiB0cnVlCiAgICBt\
ZXRhZGF0YToge30KICAgIHBhcmFtZXRlcnM6CiAgICAtIG5hbWU6IHByb2plY3RfbmFtZQogICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IFByb2plY3QgTmFtZQogICAgICBkZWZhdWx0OiBh\
cmVuZGVyLW1vbml0b3JpbmcKICAgICAgZGlzcGxheV9ncm91cDogUHJvamVjdCBwcm9wZXJ0aWVz\
CiAgICAtIG5hbWU6IGVsYXN0aWNzZWFyY2hfc3RvcmFnZV9zaXplCiAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICB0aXRsZTogRWxhc3RpY3NlYXJjaCBJbnN0YW5jZSBTdG9yYWdlIFNpemUKICAgICAg\
ZGVmYXVsdDogNUdpCiAgICAgIGRpc3BsYXlfZ3JvdXA6IFByb2plY3QgcHJvcGVydGllcwogICAg\
LSBuYW1lOiBlbGFzdGljc2VhcmNoX3Jlc291cmNlcwogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
dGl0bGU6IEVsYXN0aWNzZWFyY2ggUmVzb3VyY2UgbGltaXRzCiAgICAgIGRlZmF1bHQ6ICd7Imxp\
bWl0cyI6IHsiY3B1IjogIjEiLCJtZW1vcnkiOiAiMUcifSwicmVxdWVzdHMiOiB7ImNwdSI6ICIx\
IiwibWVtb3J5IjogIjFHIn19JwogICAgICBkaXNwbGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRp\
ZXMKICAgIC0gbmFtZToga2liYW5hX21lbW9yeV9saW1pdAogICAgICBkZWZhdWx0OiAiMjU2TWki\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogS2liYW5hIE1lbW9yeSBMaW1pdAogICAg\
ICBkaXNwbGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRpZXMK"

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-arender-monitoring-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb