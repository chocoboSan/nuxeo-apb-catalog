FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWNhLWFwYgpkZXNjcmlwdGlvbjogQ0Ega2V5IHRvIHVz\
ZSBmb3Igc2VjdXJlIE51eGVvIGRlcGxveW1lbnRzCmJpbmRhYmxlOiBGYWxzZQphc3luYzogb3B0\
aW9uYWwKdGFnczoKICAtIG51eGVvCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBDQSBrZXkgZGVw\
bG95bWVudCBmb3Igc2VjdXJlIE51eGVvIGRlcGxveW1lbnRzLgogIGxvbmdEZXNjcmlwdGlvbjog\
QW4gYXBiIHRoYXQgZGVwbG95cyBhIENBIGtleSB0byBiZSB1c2UgYnkgTnV4ZW8gYmFja2luZ3Mg\
bWlkZGxld2FyZXMuCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIk51eGVvIgogIGNvbnNvbGUub3Bl\
bnNoaWZ0LmlvL2ljb25DbGFzczogaWNvbi1zc28KcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAg\
ICBkZXNjcmlwdGlvbjogVGhpcyBkZWZhdWx0IHBsYW4gZGVwbG95cyBudXhlby1jYS1hcGIKICAg\
IGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVyczoKICAgICAgLSBuYW1l\
OiBOVVhFT19CQUNLSU5HU19OQU1FCiAgICAgICAgdGl0bGU6IFRoZSBuYW1lIG9mIHRoZSBiYWNr\
aW5ncyBzdGFjay4KICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6ICJudXhl\
by1iYWNraW5ncyIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgLSBuYW1lOiBjb3VudHJ5X25h\
bWUKICAgICAgICB0aXRsZTogQ2VydGlmaWNhdGUgQ291bnRyeSBOYW1lIChDKQogICAgICAgIGRl\
ZmF1bHQ6IHVzCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgIC0gbmFtZTogc3RhdGVfb3JfcHJv\
dmluY2VfbmFtZQogICAgICAgIHRpdGxlOiBDZXJ0aWZpY2F0ZSBTdGF0ZSBuYW1lIChTVCkKICAg\
ICAgICBkZWZhdWx0OiBjYQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAtIG5hbWU6IGxvY2Fs\
aXR5X25hbWUKICAgICAgICB0aXRsZTogQ2VydGlmaWNhdGUgTG9jYWxpdHkgbmFtZSAoTCkKICAg\
ICAgICBkZWZhdWx0OiBpcnZpbmUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgLSBuYW1lOiBv\
cmdhbml6YXRpb25fbmFtZQogICAgICAgIHRpdGxlOiBDZXJ0aWZpY2F0ZSBPcmdhbml6YXRpb24g\
bmFtZSAoTykgCiAgICAgICAgZGVmYXVsdDogbnV4ZW8KICAgICAgICB0eXBlOiBzdHJpbmcKICAg\
ICAgLSBuYW1lOiBvcmdhbml6YXRpb25hbF91bml0X25hbWUKICAgICAgICB0aXRsZTogQ2VydGlm\
aWNhdGUgT3JnYW5pemF0aW9uIFVuaXQgbmFtZSAoT1UpCiAgICAgICAgZGVmYXVsdDogZW5naW5l\
ZXJpbmcKICAgICAgICB0eXBlOiBzdHJpbmcK"

RUN yum install -y openssl
COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
