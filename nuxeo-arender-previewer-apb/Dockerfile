FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWFyZW5kZXItcHJldmlld2VyLWFwYgpkZXNjcmlwdGlv\
bjogQVJlbmRlciBQcmV2aWV3ZXIgZGVwbG95bWVudCBpbiBPcGVuc2hpZnQgZm9yIE51eGVvCmJp\
bmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gbnV4ZW8KICAtIGFyZW5kZXIK\
bWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IEFSZW5kZXIgUHJldmlld2VyIGVudmlyb25tZW50IGZv\
ciBOdXhlbwogIGltYWdlVXJsOiAiaHR0cHM6Ly93d3cubnV4ZW8uY29tL2Fzc2V0cy9pbWdzL2xv\
Z28zNDB4NjAucG5nIgogIGxvbmdEZXNjcmlwdGlvbjoKICAgIFRoaXMgRGVwbG95cyBhbiBBUmVu\
ZGVyIHByZXZpZXdlciBlbnZpcm9ubWVudCB0aGF0IGNhbiBiZSB1c2VkIHdpdGggTnV4ZW8KICBk\
ZXBlbmRlbmNpZXM6IFtdCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIk51eGVvIgpwbGFuczoKICAt\
IG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZWZhdWx0IEFSZW5kZXIgcHJldmlld2Vy\
IGRlcGxveW1lbnQKICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVy\
czoKICAgIC0gbmFtZTogcHJvamVjdF9uYW1lCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogUHJvamVjdCBOYW1lCiAgICAgIGRlZmF1bHQ6IGFyZW5kZXIKICAgICAgZGlzcGxheV9ncm91\
cDogUHJvamVjdCBwcm9wZXJ0aWVzCgogICAgLSBuYW1lOiBwcmV2aWV3ZXJfbnV4ZW9fdXJsCiAg\
ICAgIGRlZmF1bHQ6ICdodHRwczovL251eGVvLnVybC9udXhlbycKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIHRpdGxlOiBVcmwgb2YgdGhlIE51eGVvIGNsaWVudAogICAgICBkaXNwbGF5X2dyb3Vw\
OiBDbGllbnQgTnV4ZW8KICAgIC0gbmFtZTogcHJldmlld2VyX251eGVvX29hdXRoX3NlY3JldAog\
ICAgICBkZWZhdWx0OiAnT0FVVEgyX1NFQ1JFVCcKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRp\
dGxlOiBTaGFyZWQgc2VjcmV0IGZvciBPQXV0aDIgZXhjaGFuZ2UKICAgICAgZGlzcGxheV9ncm91\
cDogQ2xpZW50IE51eGVvCgogICAgLSBuYW1lOiBhcmVuZGVyX3JlbmRpdGlvbl9zZXJ2aWNlX25h\
bWUKICAgICAgZGVmYXVsdDogYXJlbmRlci1wb29sLTEKICAgICAgdHlwZTogc3RyaW5nCiAgICAg\
IHRpdGxlOiBOYW1lIG9yIHRoZSByZW5kaXRpb24gc2VydmljZSB0byB1c2UKICAgICAgZGlzcGxh\
eV9ncm91cDogQVJlbmRlciBSZW5kaXRpb24gQmluZGluZwoKICAgIC0gbmFtZTogYXJlbmRlcl9w\
cmV2aWV3ZXJfaW1hZ2UKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBBUmVuZGVyIHBy\
ZXZpZXdlciBpbWFnZQogICAgICBkZWZhdWx0OiBkb2NrZXItcHJpdmF0ZS1hcm9uZG9yLWdyb3Vw\
LnBhY2thZ2VzLm51eGVvLmNvbS9udXhlby9hcmVuZGVyLXByZXZpZXdlcgogICAgICBkaXNwbGF5\
X2dyb3VwOiBDb250YWluZXIgSW1hZ2UKICAgIC0gbmFtZTogYXJlbmRlcl9wcmV2aWV3ZXJfaW1h\
Z2VfdmVyc2lvbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEFSZW5kZXIgcHJldmll\
d2VyIGltYWdlIHZlcnNpb24KICAgICAgZGVmYXVsdDogIjEwLjEuMC1TTkFQU0hPVCIKICAgICAg\
ZGlzcGxheV9ncm91cDogQ29udGFpbmVyIEltYWdlCgogICAgLSBuYW1lOiBhcmVuZGVyX3ByZXZp\
ZXdlcl9pbWFnZV9wdWxsX2V4aXN0aW5nX3NlY3JldAogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
dGl0bGU6IE5hbWUgb2Ygc2VjcmV0IHRvIHVzZSB0byBwdWxsIGltYWdlIChMZWF2ZSBlbXB0eSBp\
ZiB5b3V0IHdhbnQgdG8gdXNlIHVzZXIvcGFzc3dvcmQpCiAgICAgIGRlZmF1bHQ6IGRvY2tlci1w\
cml2YXRlLW51eGVvCiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBJbWFnZQogICAgLSBu\
YW1lOiBhcmVuZGVyX3ByZXZpZXdlcl9pbWFnZV9wdWxsX2hvc3QKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIHRpdGxlOiBEb2NrZXIgcmVwb3NpdG9yeSB0byB1c2UgZm9yIHNlY3JldAogICAgICBk\
ZWZhdWx0OiBkb2NrZXItcHJpdmF0ZS1hcm9uZG9yLWdyb3VwLnBhY2thZ2VzLm51eGVvLmNvbQog\
ICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgSW1hZ2UKICAgIC0gbmFtZTogYXJlbmRlcl9w\
cmV2aWV3ZXJfaW1hZ2VfcHVsbF91c2VybmFtZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0\
bGU6IFVzZXJuYW1lIHRvIHVzZSB0byBwdWxsIHRoZSBEb2NrZXIgaW1hZ2UKICAgICAgZGVmYXVs\
dDogbnV4ZW8KICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIEltYWdlCiAgICAtIG5hbWU6\
IGFyZW5kZXJfcHJldmlld2VyX2ltYWdlX3B1bGxfcGFzc3dvcmQKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIHRpdGxlOiBQYXNzd29yZCB0byB1c2UgdG8gcHVsbCB0aGUgRG9ja2VyIGltYWdlCiAg\
ICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVy\
IEltYWdlCgogICAgLSBuYW1lOiBwcmV2aWV3ZXJfaW1hZ2VfcHVsbFBvbGljeQogICAgICBkZWZh\
dWx0OiAnSWZOb3RQcmVzZW50JwogICAgICB0eXBlOiBlbnVtCiAgICAgIGVudW06IFsnSWZOb3RQ\
cmVzZW50JywgJ0Fsd2F5cycsICdOZXZlciddCiAgICAgIHRpdGxlOiBBUmVuZGVyIFByZXZpZXdl\
ciBpbWFnZSBwdWxsIHBvbGljeQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MK\
CiAgICAtIG5hbWU6IHByZXZpZXdlcl9yZXNvdXJjZXMKICAgICAgZGVmYXVsdDogJ3sibGltaXRz\
IjogeyJjcHUiOiAiMiIsIm1lbW9yeSI6ICIyR2kifSwicmVxdWVzdHMiOiB7ImNwdSI6ICIxIiwi\
bWVtb3J5IjogIjFHaSJ9fScKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBQcmV2aWV3\
ZXIgUG9kIHJlc291cmNlIHJlcXVlc3RzIGFuZCBsaW1pdHMKICAgICAgZGlzcGxheV90eXBlOiB0\
ZXh0YXJlYQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MK"

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-arender-apb/
ADD . /opt/ansible/roles/nuxeo-arender-previewer-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb