FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWFyZW5kZXItcHJldmlld2VyLWFwYgpkZXNjcmlwdGlv\
bjogQVJlbmRlciBQcmV2aWV3ZXIgZGVwbG95bWVudCBpbiBPcGVuc2hpZnQgZm9yIE51eGVvCmJp\
bmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gbnV4ZW8KICAtIGFyZW5kZXIK\
bWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IEFSZW5kZXIgUHJldmlld2VyIGVudmlyb25tZW50IGZv\
ciBOdXhlbwogIGltYWdlVXJsOiAiaHR0cHM6Ly93d3cubnV4ZW8uY29tL2Fzc2V0cy9pbWdzL2xv\
Z28zNDB4NjAucG5nIgogIGxvbmdEZXNjcmlwdGlvbjoKICAgIFRoaXMgRGVwbG95cyBhbiBBUmVu\
ZGVyIHByZXZpZXdlciBlbnZpcm9ubWVudCB0aGF0IGNhbiBiZSB1c2VkIHdpdGggTnV4ZW8KICBk\
ZXBlbmRlbmNpZXM6IFtdCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIk51eGVvIgpwbGFuczoKICAt\
IG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZWZhdWx0IEFSZW5kZXIgcHJldmlld2Vy\
IGRlcGxveW1lbnQKICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVy\
czoKICAgIC0gbmFtZTogcHJvamVjdF9uYW1lCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogUHJvamVjdCBOYW1lCiAgICAgIGRlZmF1bHQ6IGFyZW5kZXIKICAgICAgZGlzcGxheV9ncm91\
cDogUHJvamVjdCBwcm9wZXJ0aWVzCgogICAgLSBuYW1lOiBwcmV2aWV3ZXJfbnV4ZW9fdXJsCiAg\
ICAgIGRlZmF1bHQ6ICdodHRwczovL251eGVvLnVybC9udXhlbycKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIHRpdGxlOiBVcmwgb2YgdGhlIE51eGVvIGNsaWVudAogICAgICBkaXNwbGF5X2dyb3Vw\
OiBDbGllbnQgTnV4ZW8KICAgIC0gbmFtZTogcHJldmlld2VyX251eGVvX29hdXRoX3NlY3JldAog\
ICAgICBkZWZhdWx0OiAnT0FVVEgyX1NFQ1JFVCcKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRp\
dGxlOiBTaGFyZWQgc2VjcmV0IGZvciBPQXV0aDIgZXhjaGFuZ2UKICAgICAgZGlzcGxheV9ncm91\
cDogQ2xpZW50IE51eGVvCgogICAgLSBuYW1lOiBhcmVuZGVyX2Jyb2tlcl9zZXJ2aWNlX25hbWUK\
ICAgICAgZGVmYXVsdDogbnV4ZW8tYXJlbmRlci0wLXJlbmRpdGlvbi1icm9rZXIuaW50LWFyZW5k\
ZXItdGVzdC5zdmMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBVUkwgb2YgQVJlbmRl\
ciByZW5kaXRpb24gYnJva2VyCiAgICAgIGRpc3BsYXlfZ3JvdXA6IEFSZW5kZXIgUmVuZGl0aW9u\
CgogICAgLSBuYW1lOiBhcmVuZGVyX3ByZXZpZXdlcl9pbWFnZQogICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgdGl0bGU6IEFSZW5kZXIgcHJldmlld2VyIGltYWdlCiAgICAgIGRlZmF1bHQ6IGRvY2tl\
ci1wcml2YXRlLWFyb25kb3ItZ3JvdXAucGFja2FnZXMubnV4ZW8uY29tL2FyZW5kZXItaG1pCiAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBJbWFnZQogICAgLSBuYW1lOiBhcmVuZGVyX3By\
ZXZpZXdlcl9pbWFnZV92ZXJzaW9uCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogQVJl\
bmRlciBwcmV2aWV3ZXIgaW1hZ2UKICAgICAgZGVmYXVsdDogIjQuMC42Lk5YMi4wIgogICAgICBk\
aXNwbGF5X2dyb3VwOiBDb250YWluZXIgSW1hZ2UKCiAgICAtIG5hbWU6IGFyZW5kZXJfcHJldmll\
d2VyX2ltYWdlX3B1bGxfZXhpc3Rpbmdfc2VjcmV0CiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0\
aXRsZTogTmFtZSBvZiBzZWNyZXQgdG8gdXNlIHRvIHB1bGwgaW1hZ2UgKExlYXZlIGVtcHR5IGlm\
IHlvdXQgd2FudCB0byB1c2UgdXNlci9wYXNzd29yZCkKICAgICAgZGVmYXVsdDogZG9ja2VyLXBy\
aXZhdGUtbnV4ZW8KICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIEltYWdlCiAgICAtIG5h\
bWU6IGFyZW5kZXJfcHJldmlld2VyX2ltYWdlX3B1bGxfaG9zdAogICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgdGl0bGU6IERvY2tlciByZXBvc2l0b3J5IHRvIHVzZSBmb3Igc2VjcmV0CiAgICAgIGRl\
ZmF1bHQ6IGRvY2tlci1wcml2YXRlLWFyb25kb3ItZ3JvdXAucGFja2FnZXMubnV4ZW8uY29tCiAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBJbWFnZQogICAgLSBuYW1lOiBhcmVuZGVyX3By\
ZXZpZXdlcl9pbWFnZV9wdWxsX3VzZXJuYW1lCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogVXNlcm5hbWUgdG8gdXNlIHRvIHB1bGwgdGhlIERvY2tlciBpbWFnZQogICAgICBkZWZhdWx0\
OiBudXhlbwogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgSW1hZ2UKICAgIC0gbmFtZTog\
YXJlbmRlcl9wcmV2aWV3ZXJfaW1hZ2VfcHVsbF9wYXNzd29yZAogICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgdGl0bGU6IFBhc3N3b3JkIHRvIHVzZSB0byBwdWxsIHRoZSBEb2NrZXIgaW1hZ2UKICAg\
ICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIg\
SW1hZ2UKCiAgICAtIG5hbWU6IHByZXZpZXdlcl9pbWFnZV9wdWxsUG9saWN5CiAgICAgIGRlZmF1\
bHQ6ICdJZk5vdFByZXNlbnQnCiAgICAgIHR5cGU6IGVudW0KICAgICAgZW51bTogWydJZk5vdFBy\
ZXNlbnQnLCAnQWx3YXlzJywgJ05ldmVyJ10KICAgICAgdGl0bGU6IEFSZW5kZXIgUHJldmlld2Vy\
IGltYWdlIHB1bGwgcG9saWN5CiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBTcGVjcwoK\
ICAgIC0gbmFtZTogcHJldmlld2VyX3Jlc291cmNlcwogICAgICBkZWZhdWx0OiAneyJsaW1pdHMi\
OiB7ImNwdSI6ICIyIiwibWVtb3J5IjogIjJHaSJ9LCJyZXF1ZXN0cyI6IHsiY3B1IjogIjEiLCJt\
ZW1vcnkiOiAiMUdpIn19JwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IFByZXZpZXdl\
ciBQb2QgcmVzb3VyY2UgcmVxdWVzdHMgYW5kIGxpbWl0cwogICAgICBkaXNwbGF5X3R5cGU6IHRl\
eHRhcmVhCiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBTcGVjcwo="

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-arender-apb/
ADD . /opt/ansible/roles/nuxeo-arender-previewer-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb