FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWFyZW5kZXItcHJldmlld2VyLWFwYgpkZXNjcmlwdGlv\
bjogVGhpcyBpcyBhIHNhbXBsZSBhcHBsaWNhdGlvbiBnZW5lcmF0ZWQgYnkgYXBiIGluaXQKYmlu\
ZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogbnV4\
ZW8tYXJlbmRlci1wcmV2aWV3ZXIKICBpbWFnZVVybDogImh0dHBzOi8vd3d3Lm51eGVvLmNvbS9h\
c3NldHMvaW1ncy9sb2dvMzQweDYwLnBuZyIKICBsb25nRGVzY3JpcHRpb246CiAgICBUaGlzIERl\
cGxveXMgYW4gQVJlbmRlciBQcmV2aWV3ZXIgZW52aXJvbm1lbnQgdGhhdCBjYW4gYmUgdXNlZCB3\
aXRoIE51eGVvCiAgZGVwZW5kZW5jaWVzOiBbXQogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJOdXhl\
byIKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogRGVmYXVsdCBBUmVu\
ZGVyIFByZXZpZXdlciBkZXBsb3ltZW50CiAgICBmcmVlOiB0cnVlCiAgICBtZXRhZGF0YToge30K\
ICAgIHBhcmFtZXRlcnM6CiAgICAtIG5hbWU6IHByb2plY3RfbmFtZQogICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgdGl0bGU6IFByb2plY3QgTmFtZQogICAgICBkZWZhdWx0OiBhcmVuZGVyCiAgICAg\
IGRpc3BsYXlfZ3JvdXA6IFByb2plY3QgcHJvcGVydGllcwogICAgLSBuYW1lOiBhcmVuZGVyX3By\
ZXZpZXdlcl9pbWFnZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEFSZW5kZXIgcHJl\
dmlld2VyIGltYWdlCiAgICAgIGRlZmF1bHQ6IGRvY2tlci1yZWdpc3RyeS5kZWZhdWx0LnN2Yzo1\
MDAwL2NvbW1vbi1pbmZyYS9hcmVuZGVyLXByZXZpZXdlcgogICAgICBkaXNwbGF5X2dyb3VwOiBQ\
cm9qZWN0IHByb3BlcnRpZXMKICAgIC0gbmFtZTogYXJlbmRlcl9wcmV2aWV3ZXJfaW1hZ2VfdmVy\
c2lvbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEltYWdlIHZlcnNpb24KICAgICAg\
ZGVmYXVsdDogIjEuMC4zLVJDNyIKICAgICAgZGlzcGxheV9ncm91cDogUHJvamVjdCBwcm9wZXJ0\
aWVzCiAgICAtIG5hbWU6IHByZXZpZXdlcl9pbWFnZV9wdWxsUG9saWN5CiAgICAgIGRlZmF1bHQ6\
ICdJZk5vdFByZXNlbnQnCiAgICAgIHR5cGU6IGVudW0KICAgICAgZW51bTogWydJZk5vdFByZXNl\
bnQnLCAnQWx3YXlzJywgJ05ldmVyJ10KICAgICAgdGl0bGU6IEFSZW5kZXIgUHJldmlld2VyIGlt\
YWdlIHB1bGwgcG9saWN5CiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBTcGVjcwogICAg\
LSBuYW1lOiBwcmV2aWV3ZXJfcG9kQW5ub3RhdGlvbnMKICAgICAgZGVmYXVsdDogJ3t9JwogICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEFubm90YXRpb25zIHRvIGJlIGFkZGVkIHRvIEFS\
ZW5kZXIgUHJldmlld2VyIHBvZHMKICAgICAgZGlzcGxheV90eXBlOiB0ZXh0YXJlYQogICAgICBk\
aXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MKICAgIC0gbmFtZTogcHJldmlld2VyX3NlY3Vy\
aXR5Q29udGV4dAogICAgICBkZWZhdWx0OiAne30nCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0\
aXRsZTogUHJldmlld2VyIFNlY3VyaXR5IGNvbnRleHQgZm9yIHRoZSBwb2QKICAgICAgZGlzcGxh\
eV90eXBlOiB0ZXh0YXJlYQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MKICAg\
IC0gbmFtZTogcHJldmlld2VyX3Jlc291cmNlcwogICAgICBkZWZhdWx0OiAneyJsaW1pdHMiOiB7\
ImNwdSI6ICIyIiwibWVtb3J5IjogIjJHaSJ9LCJyZXF1ZXN0cyI6IHsiY3B1IjogIjEiLCJtZW1v\
cnkiOiAiMUdpIn19JwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IFByZXZpZXdlciBQ\
b2QgcmVzb3VyY2UgcmVxdWVzdHMgYW5kIGxpbWl0cwogICAgICBkaXNwbGF5X3R5cGU6IHRleHRh\
cmVhCiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBTcGVjcwo="

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-arender-previewer-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb
