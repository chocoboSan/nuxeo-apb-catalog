FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWFyZW5kZXItcHJldmlld2VyLWFwYgpkZXNjcmlwdGlv\
bjogQVJlbmRlciBQcmV2aWV3ZXIgZGVwbG95bWVudCBpbiBPcGVuc2hpZnQgZm9yIE51eGVvCmJp\
bmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gbnV4ZW8KICAtIGFyZW5kZXIK\
bWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IEFSZW5kZXIgUHJldmlld2VyIGVudmlyb25tZW50IGZv\
ciBOdXhlbwogIGltYWdlVXJsOiAiaHR0cHM6Ly93d3cubnV4ZW8uY29tL2Fzc2V0cy9pbWdzL2xv\
Z28zNDB4NjAucG5nIgogIGxvbmdEZXNjcmlwdGlvbjoKICAgIFRoaXMgRGVwbG95cyBhbiBBUmVu\
ZGVyIHByZXZpZXdlciBlbnZpcm9ubWVudCB0aGF0IGNhbiBiZSB1c2VkIHdpdGggTnV4ZW8KICBk\
ZXBlbmRlbmNpZXM6IFtdCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIk51eGVvIgpwbGFuczoKICAt\
IG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZWZhdWx0IEFSZW5kZXIgcHJldmlld2Vy\
IGRlcGxveW1lbnQKICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVy\
czoKICAgIC0gbmFtZTogcHJvamVjdF9uYW1lCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogUHJvamVjdCBOYW1lCiAgICAgIGRlZmF1bHQ6IGFyZW5kZXIKICAgICAgZGlzcGxheV9ncm91\
cDogUHJvamVjdCBwcm9wZXJ0aWVzCgogICAgLSBuYW1lOiBwcmV2aWV3ZXJfbnV4ZW9fdXJsCiAg\
ICAgIGRlZmF1bHQ6ICdodHRwczovL251eGVvLnVybC9udXhlbycKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIHRpdGxlOiBVcmwgb2YgdGhlIE51eGVvIGNsaWVudAogICAgICBkaXNwbGF5X2dyb3Vw\
OiBDbGllbnQgTnV4ZW8KICAgIC0gbmFtZTogcHJldmlld2VyX251eGVvX2NsaWVudF90aW1lb3V0\
CiAgICAgIGRlZmF1bHQ6IDYwCiAgICAgIHR5cGU6IG51bWJlcgogICAgICB0aXRsZTogVGltZW91\
dCBmb3IgdGhlIE51eGVvIENsaWVudAogICAgICBkaXNwbGF5X2dyb3VwOiBDbGllbnQgTnV4ZW8K\
ICAgIC0gbmFtZTogcHJldmlld2VyX2FyZW5kZXJfbWF4X3RyaWVzCiAgICAgIGRlZmF1bHQ6IDUK\
ICAgICAgdHlwZTogbnVtYmVyCiAgICAgIHRpdGxlOiBOdW1iZXIgb2YgcmV0cmllcyBmb3IgQVJl\
bmRlciBobWkgdG8gYXNrIGZvciBhIHJlbmRpdGlvbiBjYWxsCiAgICAgIGRpc3BsYXlfZ3JvdXA6\
IENsaWVudCBOdXhlbwogICAgLSBuYW1lOiBwcmV2aWV3ZXJfbnV4ZW9fb2F1dGhfc2VjcmV0CiAg\
ICAgIGRlZmF1bHQ6ICdPQVVUSDJfU0VDUkVUJwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0\
bGU6IFNoYXJlZCBzZWNyZXQgZm9yIE9BdXRoMiBleGNoYW5nZQogICAgICBkaXNwbGF5X2dyb3Vw\
OiBDbGllbnQgTnV4ZW8KCiAgICAtIG5hbWU6IGFyZW5kZXJfcmVuZGl0aW9uX3NlcnZpY2VfbmFt\
ZQogICAgICBkZWZhdWx0OiBhcmVuZGVyLXBvb2wtMQogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
dGl0bGU6IE5hbWUgb3IgdGhlIHJlbmRpdGlvbiBzZXJ2aWNlIHRvIHVzZQogICAgICBkaXNwbGF5\
X2dyb3VwOiBBUmVuZGVyIFJlbmRpdGlvbiBCaW5kaW5nCgogICAgLSBuYW1lOiBhcmVuZGVyX3By\
ZXZpZXdlcl9pbWFnZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEFSZW5kZXIgcHJl\
dmlld2VyIGltYWdlCiAgICAgIGRlZmF1bHQ6IGRvY2tlci1wcml2YXRlLWFyb25kb3ItZ3JvdXAu\
cGFja2FnZXMubnV4ZW8uY29tL251eGVvL2FyZW5kZXItcHJldmlld2VyCiAgICAgIGRpc3BsYXlf\
Z3JvdXA6IENvbnRhaW5lciBJbWFnZQogICAgLSBuYW1lOiBhcmVuZGVyX3ByZXZpZXdlcl9pbWFn\
ZV92ZXJzaW9uCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogQVJlbmRlciBwcmV2aWV3\
ZXIgaW1hZ2UgdmVyc2lvbgogICAgICBkZWZhdWx0OiAiMTAuMS4wLVNOQVBTSE9UIgogICAgICBk\
aXNwbGF5X2dyb3VwOiBDb250YWluZXIgSW1hZ2UKCiAgICAtIG5hbWU6IGFyZW5kZXJfcHJldmll\
d2VyX2ltYWdlX3B1bGxfZXhpc3Rpbmdfc2VjcmV0CiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0\
aXRsZTogTmFtZSBvZiBzZWNyZXQgdG8gdXNlIHRvIHB1bGwgaW1hZ2UgKExlYXZlIGVtcHR5IGlm\
IHlvdXQgd2FudCB0byB1c2UgdXNlci9wYXNzd29yZCkKICAgICAgZGVmYXVsdDogZG9ja2VyLXBy\
aXZhdGUtbnV4ZW8KICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIEltYWdlCiAgICAtIG5h\
bWU6IGFyZW5kZXJfcHJldmlld2VyX2ltYWdlX3B1bGxfaG9zdAogICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgdGl0bGU6IERvY2tlciByZXBvc2l0b3J5IHRvIHVzZSBmb3Igc2VjcmV0CiAgICAgIGRl\
ZmF1bHQ6IGRvY2tlci1wcml2YXRlLWFyb25kb3ItZ3JvdXAucGFja2FnZXMubnV4ZW8uY29tCiAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBJbWFnZQogICAgLSBuYW1lOiBhcmVuZGVyX3By\
ZXZpZXdlcl9pbWFnZV9wdWxsX3VzZXJuYW1lCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogVXNlcm5hbWUgdG8gdXNlIHRvIHB1bGwgdGhlIERvY2tlciBpbWFnZQogICAgICBkZWZhdWx0\
OiBudXhlbwogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgSW1hZ2UKICAgIC0gbmFtZTog\
YXJlbmRlcl9wcmV2aWV3ZXJfaW1hZ2VfcHVsbF9wYXNzd29yZAogICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgdGl0bGU6IFBhc3N3b3JkIHRvIHVzZSB0byBwdWxsIHRoZSBEb2NrZXIgaW1hZ2UKICAg\
ICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIg\
SW1hZ2UKCiAgICAtIG5hbWU6IHByZXZpZXdlcl9pbWFnZV9wdWxsUG9saWN5CiAgICAgIGRlZmF1\
bHQ6ICdJZk5vdFByZXNlbnQnCiAgICAgIHR5cGU6IGVudW0KICAgICAgZW51bTogWydJZk5vdFBy\
ZXNlbnQnLCAnQWx3YXlzJywgJ05ldmVyJ10KICAgICAgdGl0bGU6IEFSZW5kZXIgUHJldmlld2Vy\
IGltYWdlIHB1bGwgcG9saWN5CiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBTcGVjcwoK\
ICAgIC0gbmFtZTogcGVyc2lzdGVudFZvbHVtZV9zdG9yYWdlQ2xhc3MKICAgICAgZGVmYXVsdDog\
J3NoYXJlZCcKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBTdG9yYWdlIGNsYXNzZSBu\
YW1lIChtdXN0IGJlIGNhcGFibGUgb2YgUldYKQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWlu\
ZXIgU3BlY3MKCiAgICAtIG5hbWU6IHByZXZpZXdlcl9yZXNvdXJjZXMKICAgICAgZGVmYXVsdDog\
J3sibGltaXRzIjogeyJjcHUiOiAiMiIsIm1lbW9yeSI6ICI0R2kifSwicmVxdWVzdHMiOiB7ImNw\
dSI6ICIxIiwibWVtb3J5IjogIjNHaSJ9fScKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxl\
OiBQcmV2aWV3ZXIgUG9kIHJlc291cmNlIHJlcXVlc3RzIGFuZCBsaW1pdHMKICAgICAgZGlzcGxh\
eV90eXBlOiB0ZXh0YXJlYQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MKCiAg\
ICAtIG5hbWU6IGFyZW5kZXJfYXV0b3NjYWxpbmdfbWluCiAgICAgIGRlZmF1bHQ6IDEKICAgICAg\
dHlwZTogbnVtYmVyCiAgICAgIHRpdGxlOiBBdXRvc2NhbGluZyBNaW5pbXVtIHJlcGxpY2FzCiAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IEF1dG9zY2FsaW5nCiAgICAtIG5hbWU6IGFyZW5kZXJfYXV0b3Nj\
YWxpbmdfbWF4CiAgICAgIGRlZmF1bHQ6IDEKICAgICAgdHlwZTogbnVtYmVyCiAgICAgIHRpdGxl\
OiBBdXRvc2NhbGluZyBNYXhpbXVtIHJlcGxpY2FzCiAgICAgIGRpc3BsYXlfZ3JvdXA6IEF1dG9z\
Y2FsaW5nCiAgICAtIG5hbWU6IGFyZW5kZXJfYXV0b3NjYWxpbmdfdGFyZ2V0Q1BVCiAgICAgIGRl\
ZmF1bHQ6IDgwCiAgICAgIHR5cGU6IG51bWJlcgogICAgICB0aXRsZTogQXV0b3NjYWxpbmcgVGFy\
Z2V0IENQVSBVc2FnZSBwZXJjZW50YWdlCiAgICAgIGRpc3BsYXlfZ3JvdXA6IEF1dG9zY2FsaW5n\
CgogICAgLSBuYW1lOiBhcmVuZGVyX3ByZXZpZXdlcl9nd190aW1lb3V0X2luX3NlY29uZHMKICAg\
ICAgZGVmYXVsdDogIjEyMHMiCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogR2F0ZXdh\
eSB0aW1lb3V0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IE90aGVycw=="

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-arender-apb/
ADD . /opt/ansible/roles/nuxeo-arender-previewer-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb