FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWFyZW5kZXItcHJldmlld2VyLWFwYgpkZXNjcmlwdGlv\
bjogQVJlbmRlciBQcmV2aWV3ZXIgZGVwbG95bWVudCBpbiBPcGVuc2hpZnQgZm9yIE51eGVvCmJp\
bmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gbnV4ZW8KICAtIGFyZW5kZXIK\
bWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IEFSZW5kZXIgUHJldmlld2VyIGVudmlyb25tZW50IGZv\
ciBOdXhlbwogIGltYWdlVXJsOiAiaHR0cHM6Ly93d3cubnV4ZW8uY29tL2Fzc2V0cy9pbWdzL2xv\
Z28zNDB4NjAucG5nIgogIGxvbmdEZXNjcmlwdGlvbjoKICAgIFRoaXMgRGVwbG95cyBhbiBBUmVu\
ZGVyIHByZXZpZXdlciBlbnZpcm9ubWVudCB0aGF0IGNhbiBiZSB1c2VkIHdpdGggTnV4ZW8KICBk\
ZXBlbmRlbmNpZXM6IFtdCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIk51eGVvIgpwbGFuczoKICAt\
IG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZWZhdWx0IEFSZW5kZXIgcHJldmlld2Vy\
IGRlcGxveW1lbnQKICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVy\
czoKICAgIC0gbmFtZTogcHJvamVjdF9uYW1lCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogUHJvamVjdCBOYW1lCiAgICAgIGRlZmF1bHQ6IGFyZW5kZXIKICAgICAgZGlzcGxheV9ncm91\
cDogUHJvamVjdCBwcm9wZXJ0aWVzCgogICAgLSBuYW1lOiBwcmV2aWV3ZXJfbnV4ZW9fdXJsCiAg\
ICAgIGRlZmF1bHQ6ICdodHRwczovL251eGVvLnVybC9udXhlbycKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIHRpdGxlOiBVcmwgb2YgdGhlIE51eGVvIGNsaWVudAogICAgICBkaXNwbGF5X2dyb3Vw\
OiBDbGllbnQgTnV4ZW8KICAgIC0gbmFtZTogcHJldmlld2VyX251eGVvX2NsaWVudF90aW1lb3V0\
CiAgICAgIGRlZmF1bHQ6IDYwCiAgICAgIHR5cGU6IG51bWJlcgogICAgICB0aXRsZTogVGltZW91\
dCBmb3IgdGhlIE51eGVvIENsaWVudAogICAgICBkaXNwbGF5X2dyb3VwOiBDbGllbnQgTnV4ZW8K\
ICAgIC0gbmFtZTogcHJldmlld2VyX251eGVvX29hdXRoX3NlY3JldAogICAgICBkZWZhdWx0OiAn\
T0FVVEgyX1NFQ1JFVCcKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBTaGFyZWQgc2Vj\
cmV0IGZvciBPQXV0aDIgZXhjaGFuZ2UKICAgICAgZGlzcGxheV9ncm91cDogQ2xpZW50IE51eGVv\
CgogICAgLSBuYW1lOiBhcmVuZGVyX3JlbmRpdGlvbl9zZXJ2aWNlX25hbWUKICAgICAgZGVmYXVs\
dDogYXJlbmRlci1wb29sLTEKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBOYW1lIG9y\
IHRoZSByZW5kaXRpb24gc2VydmljZSB0byB1c2UKICAgICAgZGlzcGxheV9ncm91cDogQVJlbmRl\
ciBSZW5kaXRpb24gQmluZGluZwoKICAgIC0gbmFtZTogYXJlbmRlcl9wcmV2aWV3ZXJfaW1hZ2UK\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBBUmVuZGVyIHByZXZpZXdlciBpbWFnZQog\
ICAgICBkZWZhdWx0OiBkb2NrZXItcHJpdmF0ZS1hcm9uZG9yLWdyb3VwLnBhY2thZ2VzLm51eGVv\
LmNvbS9udXhlby9hcmVuZGVyLXByZXZpZXdlcgogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWlu\
ZXIgSW1hZ2UKICAgIC0gbmFtZTogYXJlbmRlcl9wcmV2aWV3ZXJfaW1hZ2VfdmVyc2lvbgogICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEFSZW5kZXIgcHJldmlld2VyIGltYWdlIHZlcnNp\
b24KICAgICAgZGVmYXVsdDogIjEwLjEuMC1TTkFQU0hPVCIKICAgICAgZGlzcGxheV9ncm91cDog\
Q29udGFpbmVyIEltYWdlCgogICAgLSBuYW1lOiBhcmVuZGVyX3ByZXZpZXdlcl9pbWFnZV9wdWxs\
X2V4aXN0aW5nX3NlY3JldAogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IE5hbWUgb2Yg\
c2VjcmV0IHRvIHVzZSB0byBwdWxsIGltYWdlIChMZWF2ZSBlbXB0eSBpZiB5b3V0IHdhbnQgdG8g\
dXNlIHVzZXIvcGFzc3dvcmQpCiAgICAgIGRlZmF1bHQ6IGRvY2tlci1wcml2YXRlLW51eGVvCiAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBJbWFnZQogICAgLSBuYW1lOiBhcmVuZGVyX3By\
ZXZpZXdlcl9pbWFnZV9wdWxsX2hvc3QKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBE\
b2NrZXIgcmVwb3NpdG9yeSB0byB1c2UgZm9yIHNlY3JldAogICAgICBkZWZhdWx0OiBkb2NrZXIt\
cHJpdmF0ZS1hcm9uZG9yLWdyb3VwLnBhY2thZ2VzLm51eGVvLmNvbQogICAgICBkaXNwbGF5X2dy\
b3VwOiBDb250YWluZXIgSW1hZ2UKICAgIC0gbmFtZTogYXJlbmRlcl9wcmV2aWV3ZXJfaW1hZ2Vf\
cHVsbF91c2VybmFtZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IFVzZXJuYW1lIHRv\
IHVzZSB0byBwdWxsIHRoZSBEb2NrZXIgaW1hZ2UKICAgICAgZGVmYXVsdDogbnV4ZW8KICAgICAg\
ZGlzcGxheV9ncm91cDogQ29udGFpbmVyIEltYWdlCiAgICAtIG5hbWU6IGFyZW5kZXJfcHJldmll\
d2VyX2ltYWdlX3B1bGxfcGFzc3dvcmQKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBQ\
YXNzd29yZCB0byB1c2UgdG8gcHVsbCB0aGUgRG9ja2VyIGltYWdlCiAgICAgIGRpc3BsYXlfdHlw\
ZTogcGFzc3dvcmQKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIEltYWdlCgogICAgLSBu\
YW1lOiBwcmV2aWV3ZXJfaW1hZ2VfcHVsbFBvbGljeQogICAgICBkZWZhdWx0OiAnSWZOb3RQcmVz\
ZW50JwogICAgICB0eXBlOiBlbnVtCiAgICAgIGVudW06IFsnSWZOb3RQcmVzZW50JywgJ0Fsd2F5\
cycsICdOZXZlciddCiAgICAgIHRpdGxlOiBBUmVuZGVyIFByZXZpZXdlciBpbWFnZSBwdWxsIHBv\
bGljeQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MKCiAgICAtIG5hbWU6IHBl\
cnNpc3RlbnRWb2x1bWVfc3RvcmFnZUNsYXNzCiAgICAgIGRlZmF1bHQ6ICdzaGFyZWQnCiAgICAg\
IHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogU3RvcmFnZSBjbGFzc2UgbmFtZSAobXVzdCBiZSBj\
YXBhYmxlIG9mIFJXWCkKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIFNwZWNzCgogICAg\
LSBuYW1lOiBwcmV2aWV3ZXJfcmVzb3VyY2VzCiAgICAgIGRlZmF1bHQ6ICd7ImxpbWl0cyI6IHsi\
Y3B1IjogIjIiLCJtZW1vcnkiOiAiNEdpIn0sInJlcXVlc3RzIjogeyJjcHUiOiAiMSIsIm1lbW9y\
eSI6ICIzR2kifX0nCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogUHJldmlld2VyIFBv\
ZCByZXNvdXJjZSByZXF1ZXN0cyBhbmQgbGltaXRzCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4dGFy\
ZWEKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIFNwZWNzCgogICAgLSBuYW1lOiBhcmVu\
ZGVyX2F1dG9zY2FsaW5nX21pbgogICAgICBkZWZhdWx0OiAxCiAgICAgIHR5cGU6IG51bWJlcgog\
ICAgICB0aXRsZTogQXV0b3NjYWxpbmcgTWluaW11bSByZXBsaWNhcwogICAgICBkaXNwbGF5X2dy\
b3VwOiBBdXRvc2NhbGluZwogICAgLSBuYW1lOiBhcmVuZGVyX2F1dG9zY2FsaW5nX21heAogICAg\
ICBkZWZhdWx0OiAxMAogICAgICB0eXBlOiBudW1iZXIKICAgICAgdGl0bGU6IEF1dG9zY2FsaW5n\
IE1heGltdW0gcmVwbGljYXMKICAgICAgZGlzcGxheV9ncm91cDogQXV0b3NjYWxpbmcKICAgIC0g\
bmFtZTogYXJlbmRlcl9hdXRvc2NhbGluZ190YXJnZXRDUFUKICAgICAgZGVmYXVsdDogODAKICAg\
ICAgdHlwZTogbnVtYmVyCiAgICAgIHRpdGxlOiBBdXRvc2NhbGluZyBUYXJnZXQgQ1BVIFVzYWdl\
IHBlcmNlbnRhZ2UKICAgICAgZGlzcGxheV9ncm91cDogQXV0b3NjYWxpbmcKCiAgICAtIG5hbWU6\
IGFyZW5kZXJfcHJldmlld2VyX2d3X3RpbWVvdXRfaW5fc2Vjb25kcwogICAgICBkZWZhdWx0OiAi\
MTIwcyIKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBHYXRld2F5IHRpbWVvdXQKICAg\
ICAgZGlzcGxheV9ncm91cDogT3RoZXJz"

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-arender-apb/
ADD . /opt/ansible/roles/nuxeo-arender-previewer-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb