FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBudXhlby1hcmVuZGVyLXJlbmRpdGlvbi1hcGIKZGVzY3Jp\
cHRpb246IEFSZW5kZXIgUmVuZGl0aW9uIGRlcGxveW1lbnQgaW4gT3BlbnNoaWZ0IGZvciBOdXhl\
bwpiaW5kYWJsZTogVHJ1ZQphc3luYzogb3B0aW9uYWwKdGFnczoKICAtIG51eGVvCiAgLSBudXhl\
by1hcmVuZGVyLXJlbmRpdGlvbgptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogQVJlbmRlciBSZW5k\
aXRpb24gZW52aXJvbm1lbnQgZm9yIE51eGVvCiAgaW1hZ2VVcmw6ICJodHRwczovL3d3dy5udXhl\
by5jb20vYXNzZXRzL2ltZ3MvbG9nbzM0MHg2MC5wbmciCiAgbG9uZ0Rlc2NyaXB0aW9uOgogICAg\
VGhpcyBEZXBsb3lzIGFuIEFSZW5kZXIgUmVuZGl0aW9uIGVudmlyb25tZW50IHRoYXQgY2FuIGJl\
IHVzZWQgd2l0aCBOdXhlbwogIGRlcGVuZGVuY2llczogW10KICBwcm92aWRlckRpc3BsYXlOYW1l\
OiAiTnV4ZW8iCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IERlZmF1\
bHQgQVJlbmRlciBSZW5kaXRpb24gZGVwbG95bWVudAogICAgZnJlZTogdHJ1ZQogICAgbWV0YWRh\
dGE6IHt9CiAgICBwYXJhbWV0ZXJzOgogICAgLSBuYW1lOiBwcm9qZWN0X25hbWUKICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgIHRpdGxlOiBQcm9qZWN0IE5hbWUKICAgICAgZGVmYXVsdDogYXJlbmRl\
cgogICAgICBkaXNwbGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRpZXMKCiAgICAtIG5hbWU6IGFy\
ZW5kZXJfcmVuZGl0aW9uX2ltYWdlX3JlZ2lzdHJ5CiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0\
aXRsZTogQVJlbmRlciByZW5kaXRpb24gaW1hZ2UKICAgICAgZGVmYXVsdDogZG9ja2VyLXByaXZh\
dGUtYXJvbmRvci1ncm91cC5wYWNrYWdlcy5udXhlby5jb20KICAgICAgZGlzcGxheV9ncm91cDog\
Q29udGFpbmVyIEltYWdlCiAgICAtIG5hbWU6IGFyZW5kZXJfcmVuZGl0aW9uX2ltYWdlX3ZlcnNp\
b24KICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBBUmVuZGVyIHJlbmRpdGlvbiBpbWFn\
ZQogICAgICBkZWZhdWx0OiAiNC4wLjYuTlgyLjAiCiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRh\
aW5lciBJbWFnZQogICAgLSBuYW1lOiBhcmVuZGVyX3JlbmRpdGlvbl9pbWFnZV9wdWxsX2V4aXN0\
aW5nX3NlY3JldAogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IE5hbWUgb2Ygc2VjcmV0\
IHRvIHVzZSB0byBwdWxsIGltYWdlIChMZWF2ZSBlbXB0eSBpZiB5b3V0IHdhbnQgdG8gdXNlIHVz\
ZXIvcGFzc3dvcmQpCiAgICAgIGRlZmF1bHQ6IGRvY2tlci1wcml2YXRlLW51eGVvCiAgICAgIGRp\
c3BsYXlfZ3JvdXA6IENvbnRhaW5lciBJbWFnZQogICAgLSBuYW1lOiBhcmVuZGVyX3JlbmRpdGlv\
bl9pbWFnZV9wdWxsX3VzZXJuYW1lCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogVXNl\
cm5hbWUgdG8gdXNlIHRvIHB1bGwgdGhlIERvY2tlciBpbWFnZQogICAgICBkZWZhdWx0OiBudXhl\
bwogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgSW1hZ2UKICAgIC0gbmFtZTogYXJlbmRl\
cl9yZW5kaXRpb25faW1hZ2VfcHVsbF9wYXNzd29yZAogICAgICB0eXBlOiBwYXNzd29yZAogICAg\
ICB0aXRsZTogUGFzc3dvcmQgdG8gdXNlIHRvIHB1bGwgdGhlIERvY2tlciBpbWFnZQogICAgICBk\
aXNwbGF5X2dyb3VwOiBDb250YWluZXIgSW1hZ2UKCiAgICAtIG5hbWU6IGFyZW5kZXJfYnJva2Vy\
X3Jlc291cmNlcwogICAgICBkZWZhdWx0OiAneyJsaW1pdHMiOiB7ImNwdSI6ICIxIiwibWVtb3J5\
IjogIjFHaSJ9LCJyZXF1ZXN0cyI6IHsiY3B1IjogIjEiLCJtZW1vcnkiOiAiMUdpIn19JwogICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEJyb2tlciBQb2QgcmVzb3VyY2UgcmVxdWVzdHMg\
YW5kIGxpbWl0cwogICAgICBkaXNwbGF5X3R5cGU6IHRleHRhcmVhCiAgICAgIGRpc3BsYXlfZ3Jv\
dXA6IENvbnRhaW5lciBTcGVjcwogICAgLSBuYW1lOiBhcmVuZGVyX2NvbnZlcnRlcl9yZXNvdXJj\
ZXMKICAgICAgZGVmYXVsdDogJ3sibGltaXRzIjogeyJjcHUiOiAiMSIsIm1lbW9yeSI6ICIyR2ki\
fSwicmVxdWVzdHMiOiB7ImNwdSI6ICIxIiwibWVtb3J5IjogIjJHaSJ9fScKICAgICAgdHlwZTog\
c3RyaW5nCiAgICAgIHRpdGxlOiBDb252ZXJ0ZXIgUG9kIHJlc291cmNlIHJlcXVlc3RzIGFuZCBs\
aW1pdHMKICAgICAgZGlzcGxheV90eXBlOiB0ZXh0YXJlYQogICAgICBkaXNwbGF5X2dyb3VwOiBD\
b250YWluZXIgU3BlY3MKICAgIC0gbmFtZTogYXJlbmRlcl9wZGZib3hfcmVzb3VyY2VzCiAgICAg\
IGRlZmF1bHQ6ICd7ImxpbWl0cyI6IHsiY3B1IjogIjEiLCJtZW1vcnkiOiAiMUdpIn0sInJlcXVl\
c3RzIjogeyJjcHUiOiAiMSIsIm1lbW9yeSI6ICIxR2kifX0nCiAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICB0aXRsZTogUERGQm94IFBvZCByZXNvdXJjZSByZXF1ZXN0cyBhbmQgbGltaXRzCiAgICAg\
IGRpc3BsYXlfdHlwZTogdGV4dGFyZWEKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIFNw\
ZWNzCiAgICAtIG5hbWU6IGFyZW5kZXJfam5pX3Jlc291cmNlcwogICAgICBkZWZhdWx0OiAneyJs\
aW1pdHMiOiB7ImNwdSI6ICIyIiwibWVtb3J5IjogIjJHaSJ9LCJyZXF1ZXN0cyI6IHsiY3B1Ijog\
IjIiLCJtZW1vcnkiOiAiMkdpIn19JwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEpO\
SSBQb2QgcmVzb3VyY2UgcmVxdWVzdHMgYW5kIGxpbWl0cwogICAgICBkaXNwbGF5X3R5cGU6IHRl\
eHRhcmVhCiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBTcGVjcwogICAgLSBuYW1lOiBh\
cmVuZGVyX2Rmc19yZXNvdXJjZXMKICAgICAgZGVmYXVsdDogJ3sibGltaXRzIjogeyJjcHUiOiAi\
MSIsIm1lbW9yeSI6ICI1MTJNIn0sInJlcXVlc3RzIjogeyJjcHUiOiAiMSIsIm1lbW9yeSI6ICI1\
MTJNIn19JwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IERGUyBQb2QgcmVzb3VyY2Ug\
cmVxdWVzdHMgYW5kIGxpbWl0cwogICAgICBkaXNwbGF5X3R5cGU6IHRleHRhcmVhCiAgICAgIGRp\
c3BsYXlfZ3JvdXA6IENvbnRhaW5lciBTcGVjcwo="

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-arender-apb/
ADD . /opt/ansible/roles/nuxeo-arender-rendition-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb