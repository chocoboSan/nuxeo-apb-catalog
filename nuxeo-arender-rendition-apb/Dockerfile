FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBudXhlby1hcmVuZGVyLXJlbmRpdGlvbi1hcGIKZGVzY3Jp\
cHRpb246IEFSZW5kZXIgUmVuZGl0aW9uIGRlcGxveW1lbnQgaW4gT3BlbnNoaWZ0IGZvciBOdXhl\
bwpiaW5kYWJsZTogVHJ1ZQphc3luYzogb3B0aW9uYWwKdGFnczoKICAtIG51eGVvCiAgLSBudXhl\
by1hcmVuZGVyLXJlbmRpdGlvbgptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogQVJlbmRlciBSZW5k\
aXRpb24gZW52aXJvbm1lbnQgZm9yIE51eGVvCiAgaW1hZ2VVcmw6ICJodHRwczovL3d3dy5udXhl\
by5jb20vYXNzZXRzL2ltZ3MvbG9nbzM0MHg2MC5wbmciCiAgbG9uZ0Rlc2NyaXB0aW9uOgogICAg\
VGhpcyBEZXBsb3lzIGFuIEFSZW5kZXIgUmVuZGl0aW9uIGVudmlyb25tZW50IHRoYXQgY2FuIGJl\
IHVzZWQgd2l0aCBOdXhlbwogIGRlcGVuZGVuY2llczogW10KICBwcm92aWRlckRpc3BsYXlOYW1l\
OiAiTnV4ZW8iCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IERlZmF1\
bHQgQVJlbmRlciBSZW5kaXRpb24gZGVwbG95bWVudAogICAgZnJlZTogdHJ1ZQogICAgbWV0YWRh\
dGE6IHt9CiAgICBwYXJhbWV0ZXJzOgogICAgLSBuYW1lOiBwcm9qZWN0X25hbWUKICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgIHRpdGxlOiBQcm9qZWN0IE5hbWUKICAgICAgZGVmYXVsdDogYXJlbmRl\
cgogICAgICBkaXNwbGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRpZXMKCiAgICAtIG5hbWU6IGFy\
ZW5kZXJfcmVuZGl0aW9uX2ltYWdlX3JlZ2lzdHJ5CiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0\
aXRsZTogQVJlbmRlciByZW5kaXRpb24gaW1hZ2UKICAgICAgZGVmYXVsdDogZG9ja2VyLXByaXZh\
dGUtYXJvbmRvci1ncm91cC5wYWNrYWdlcy5udXhlby5jb20KICAgICAgZGlzcGxheV9ncm91cDog\
Q29udGFpbmVyIEltYWdlCiAgICAtIG5hbWU6IGFyZW5kZXJfcmVuZGl0aW9uX2ltYWdlX3ZlcnNp\
b24KICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBBUmVuZGVyIHJlbmRpdGlvbiBpbWFn\
ZQogICAgICBkZWZhdWx0OiAiNC4wLjYuTlgyLjAiCiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRh\
aW5lciBJbWFnZQogICAgLSBuYW1lOiBhcmVuZGVyX3JlbmRpdGlvbl9pbWFnZV9wdWxsX2V4aXN0\
aW5nX3NlY3JldAogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IE5hbWUgb2Ygc2VjcmV0\
IHRvIHVzZSB0byBwdWxsIGltYWdlIChMZWF2ZSBlbXB0eSBpZiB5b3V0IHdhbnQgdG8gdXNlIHVz\
ZXIvcGFzc3dvcmQpCiAgICAgIGRlZmF1bHQ6IGRvY2tlci1wcml2YXRlLW51eGVvCiAgICAgIGRp\
c3BsYXlfZ3JvdXA6IENvbnRhaW5lciBJbWFnZQogICAgLSBuYW1lOiBhcmVuZGVyX3JlbmRpdGlv\
bl9pbWFnZV9wdWxsX3VzZXJuYW1lCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogVXNl\
cm5hbWUgdG8gdXNlIHRvIHB1bGwgdGhlIERvY2tlciBpbWFnZQogICAgICBkZWZhdWx0OiBudXhl\
bwogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgSW1hZ2UKICAgIC0gbmFtZTogYXJlbmRl\
cl9yZW5kaXRpb25faW1hZ2VfcHVsbF9wYXNzd29yZAogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
dGl0bGU6IFBhc3N3b3JkIHRvIHVzZSB0byBwdWxsIHRoZSBEb2NrZXIgaW1hZ2UKICAgICAgZGlz\
cGxheV90eXBlOiBwYXNzd29yZAogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgSW1hZ2UK\
CiAgICAtIG5hbWU6IGFyZW5kZXJfYXV0b3NjYWxpbmdfbWluCiAgICAgIGRlZmF1bHQ6IDEKICAg\
ICAgdHlwZTogbnVtYmVyCiAgICAgIHRpdGxlOiBBdXRvc2NhbGluZyBNaW5pbXVtIHJlcGxpY2Fz\
CiAgICAgIGRpc3BsYXlfZ3JvdXA6IEF1dG9zY2FsaW5nCiAgICAtIG5hbWU6IGFyZW5kZXJfYXV0\
b3NjYWxpbmdfbWF4CiAgICAgIGRlZmF1bHQ6IDEwCiAgICAgIHR5cGU6IG51bWJlcgogICAgICB0\
aXRsZTogQXV0b3NjYWxpbmcgTWF4aW11bSByZXBsaWNhcwogICAgICBkaXNwbGF5X2dyb3VwOiBB\
dXRvc2NhbGluZwogICAgLSBuYW1lOiBhcmVuZGVyX2F1dG9zY2FsaW5nX3RhcmdldENQVQogICAg\
ICBkZWZhdWx0OiA4MAogICAgICB0eXBlOiBudW1iZXIKICAgICAgdGl0bGU6IEF1dG9zY2FsaW5n\
IFRhcmdldCBDUFUgVXNhZ2UgcGVyY2VudGFnZQogICAgICBkaXNwbGF5X2dyb3VwOiBBdXRvc2Nh\
bGluZwoKICAgIC0gbmFtZTogYXJlbmRlcl9icm9rZXJfcmVzb3VyY2VzCiAgICAgIGRlZmF1bHQ6\
ICd7ImxpbWl0cyI6IHsiY3B1IjogIjEiLCJtZW1vcnkiOiAiMUdpIn0sInJlcXVlc3RzIjogeyJj\
cHUiOiAiMSIsIm1lbW9yeSI6ICIxR2kifX0nCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogQnJva2VyIFBvZCByZXNvdXJjZSByZXF1ZXN0cyBhbmQgbGltaXRzCiAgICAgIGRpc3BsYXlf\
dHlwZTogdGV4dGFyZWEKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIFNwZWNzCiAgICAt\
IG5hbWU6IGFyZW5kZXJfY29udmVydGVyX3Jlc291cmNlcwogICAgICBkZWZhdWx0OiAneyJsaW1p\
dHMiOiB7ImNwdSI6ICIxIiwibWVtb3J5IjogIjZHaSJ9LCJyZXF1ZXN0cyI6IHsiY3B1IjogIjUw\
MG0iLCJtZW1vcnkiOiAiNEdpIn19JwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IENv\
bnZlcnRlciBQb2QgcmVzb3VyY2UgcmVxdWVzdHMgYW5kIGxpbWl0cwogICAgICBkaXNwbGF5X3R5\
cGU6IHRleHRhcmVhCiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBTcGVjcwogICAgLSBu\
YW1lOiBhcmVuZGVyX3BkZmJveF9yZXNvdXJjZXMKICAgICAgZGVmYXVsdDogJ3sibGltaXRzIjog\
eyJjcHUiOiAiMSIsIm1lbW9yeSI6ICIxR2kifSwicmVxdWVzdHMiOiB7ImNwdSI6ICIxIiwibWVt\
b3J5IjogIjFHaSJ9fScKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBQREZCb3ggUG9k\
IHJlc291cmNlIHJlcXVlc3RzIGFuZCBsaW1pdHMKICAgICAgZGlzcGxheV90eXBlOiB0ZXh0YXJl\
YQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MKICAgIC0gbmFtZTogYXJlbmRl\
cl9qbmlfcmVzb3VyY2VzCiAgICAgIGRlZmF1bHQ6ICd7ImxpbWl0cyI6IHsiY3B1IjogIjIiLCJt\
ZW1vcnkiOiAiMkdpIn0sInJlcXVlc3RzIjogeyJjcHUiOiAiMiIsIm1lbW9yeSI6ICIyR2kifX0n\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogSk5JIFBvZCByZXNvdXJjZSByZXF1ZXN0\
cyBhbmQgbGltaXRzCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4dGFyZWEKICAgICAgZGlzcGxheV9n\
cm91cDogQ29udGFpbmVyIFNwZWNzCiAgICAtIG5hbWU6IGFyZW5kZXJfZGZzX3Jlc291cmNlcwog\
ICAgICBkZWZhdWx0OiAneyJsaW1pdHMiOiB7ImNwdSI6ICIxIiwibWVtb3J5IjogIjUxMk0ifSwi\
cmVxdWVzdHMiOiB7ImNwdSI6ICIxIiwibWVtb3J5IjogIjUxMk0ifX0nCiAgICAgIHR5cGU6IHN0\
cmluZwogICAgICB0aXRsZTogREZTIFBvZCByZXNvdXJjZSByZXF1ZXN0cyBhbmQgbGltaXRzCiAg\
ICAgIGRpc3BsYXlfdHlwZTogdGV4dGFyZWEKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVy\
IFNwZWNzCiAgICAtIG5hbWU6IHBlcnNpc3RlbnRWb2x1bWVfc3RvcmFnZUNsYXNzCiAgICAgIGRl\
ZmF1bHQ6ICdzaGFyZWQnCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogU3RvcmFnZSBj\
bGFzc2UgbmFtZSAobXVzdCBiZSBjYXBhYmxlIG9mIFJXWCkKICAgICAgZGlzcGxheV9ncm91cDog\
Q29udGFpbmVyIFNwZWNzCgogICAgLSBuYW1lOiBhcmVuZGVyX2RlYnVnX3BvZAogICAgICBkZWZh\
dWx0OiBmYWxzZQogICAgICB0eXBlOiBib29sZWFuCiAgICAgIGRpc3BsYXlfdHlwZTogY2hlY2ti\
b3gKICAgICAgdGl0bGU6IERlcGxveSBhIGRlYnVnIHBvZAogICAgICBkaXNwbGF5X2dyb3VwOiBP\
dGhlcnMKCiAgICAtIG5hbWU6IGFyZW5kZXJfcmVuZGl0aW9uX2ltYWdlbWFnaWNrX29wdGlvbnMK\
ICAgICAgZGVmYXVsdDogJy1xdWFsaXR5LDEwMCwtZGVuc2l0eSw3Mng3MiwtdW5pdHMsUGl4ZWxz\
UGVySW5jaCwtYXV0by1vcmllbnQsK3JlcGFnZScKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRp\
dGxlOiBPcHRpb25zIHBhc3NlZCB0byBJbWFnZSBNYWdpY2sgZm9yIGNvbnZlcnNpb25zCiAgICAg\
IGRpc3BsYXlfZ3JvdXA6IEFSZW5kZXIgY29uZmlndXJhdGlvbgoKICAgIC0gbmFtZTogYXJlbmRl\
cl9yZW5kaXRpb25fY29udmVyc2lvbl90aW1lb3V0CiAgICAgIGRlZmF1bHQ6IDEyMAogICAgICB0\
eXBlOiBudW1iZXIKICAgICAgdGl0bGU6IFRpbWVvdXQgZm9yIGNvbnZlcnNpb24KICAgICAgZGlz\
cGxheV9ncm91cDogQVJlbmRlciBjb25maWd1cmF0aW9u"


ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-arender-apb/
ADD . /opt/ansible/roles/nuxeo-arender-rendition-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb