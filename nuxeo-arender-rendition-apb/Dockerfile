FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWFyZW5kZXItcmVuZGl0aW9uLWFwYgpkZXNjcmlwdGlv\
bjogVGhpcyBpcyBhIHNhbXBsZSBhcHBsaWNhdGlvbiBnZW5lcmF0ZWQgYnkgYXBiIGluaXQKYmlu\
ZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gbnV4ZW8KICAtIGFyZW5kZXIt\
cmVuZGl0aW9uCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBBUmVuZGVyIHJlbmRpdGlvbiBmb3Ig\
TnV4ZW8KICBpbWFnZVVybDogImh0dHBzOi8vd3d3Lm51eGVvLmNvbS9hc3NldHMvaW1ncy9sb2dv\
MzQweDYwLnBuZyIKICBsb25nRGVzY3JpcHRpb246CiAgICBUaGlzIERlcGxveXMgYW4gQVJlbmRl\
ciByZW5kaXRpb24gdGhhdCBjYW4gYmUgdXNlZCB3aXRoIE51eGVvIFByZXZpZXdlcgogIGRlcGVu\
ZGVuY2llczogW10KICBwcm92aWRlckRpc3BsYXlOYW1lOiAiTnV4ZW8iCnBsYW5zOgogIC0gbmFt\
ZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IFRoaXMgZGVmYXVsdCBwbGFuIGRlcGxveXMgbnV4\
ZW8tYXJlbmRlci1yZW5kaXRpb24tYXBiCiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToge30K\
ICAgIHBhcmFtZXRlcnM6CiAgICAtIG5hbWU6IHByb2plY3RfbmFtZQogICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgdGl0bGU6IFByb2plY3QgTmFtZQogICAgICBkZWZhdWx0OiBhcmVuZGVyLXJlbmRp\
dGlvbgogICAgICBkaXNwbGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRpZXMKICAgIC0gbmFtZTog\
YXJlbmRlcl9yZW5kaXRpb25faW1hZ2UKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBB\
UmVuZGVyIHJlbmRpdGlvbiBpbWFnZQogICAgICBkZWZhdWx0OiBkb2NrZXItcmVnaXN0cnkuZGVm\
YXVsdC5zdmM6NTAwMC9jb21tb24taW5mcmEvYXJlbmRlci1yZW5kaXRpb24KICAgICAgZGlzcGxh\
eV9ncm91cDogUHJvamVjdCBwcm9wZXJ0aWVzCiAgICAtIG5hbWU6IGFyZW5kZXJfcmVuZGl0aW9u\
X2ltYWdlX3ZlcnNpb24KICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBJbWFnZSB2ZXJz\
aW9uCiAgICAgIGRlZmF1bHQ6ICIxLjAuMy1SQzciCiAgICAgIGRpc3BsYXlfZ3JvdXA6IFByb2pl\
Y3QgcHJvcGVydGllcwogICAgLSBuYW1lOiByZW5kaXRpb25faW1hZ2VfcHVsbFBvbGljeQogICAg\
ICBkZWZhdWx0OiAnSWZOb3RQcmVzZW50JwogICAgICB0eXBlOiBlbnVtCiAgICAgIGVudW06IFsn\
SWZOb3RQcmVzZW50JywgJ0Fsd2F5cycsICdOZXZlciddCiAgICAgIHRpdGxlOiBBUmVuZGVyIFJl\
bmRpdGlvbiBpbWFnZSBwdWxsIHBvbGljeQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIg\
U3BlY3MKICAgIC0gbmFtZTogcmVuZGl0aW9uX3BvZEFubm90YXRpb25zCiAgICAgIGRlZmF1bHQ6\
ICd7fScKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBBbm5vdGF0aW9ucyB0byBiZSBh\
ZGRlZCB0byBBUmVuZGVyIFJlbmRpdGlvbiBwb2RzCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4dGFy\
ZWEKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIFNwZWNzCiAgICAtIG5hbWU6IHJlbmRp\
dGlvbl9zZWN1cml0eUNvbnRleHQKICAgICAgZGVmYXVsdDogJ3t9JwogICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgdGl0bGU6IFNlY3VyaXR5IGNvbnRleHQgZm9yIHRoZSBSZW5kaXRpb24gcG9kCiAg\
ICAgIGRpc3BsYXlfdHlwZTogdGV4dGFyZWEKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVy\
IFNwZWNzCiAgICAtIG5hbWU6IHJlbmRpdGlvbl9yZXNvdXJjZXMKICAgICAgZGVmYXVsdDogJ3si\
bGltaXRzIjogeyJjcHUiOiAiMiIsIm1lbW9yeSI6ICI0R2kifSwicmVxdWVzdHMiOiB7ImNwdSI6\
ICIxIiwibWVtb3J5IjogIjJHaSJ9fScKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBS\
ZW5kaXRpb24gUG9kIHJlc291cmNlIHJlcXVlc3RzIGFuZCBsaW1pdHMKICAgICAgZGlzcGxheV90\
eXBlOiB0ZXh0YXJlYQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MK"


ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-arender-rendition-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb
